# Алгоритм локального ответа на вопросы (FAQ)

Цель: дать быстрый ответ пользователю офлайн, опираясь на локальный файл FAQ в assets.

## Шаги

1. Загрузка FAQ
   - При первом запросе загружаем `assets/faq.md` через `rootBundle.loadString`.
   - Кэшируем исходный текст и индекс.

2. Индексация
   - Разбиваем Markdown на секции по заголовкам `#`, `##`, ...
   - Для каждой секции сохраняем: title, body, tokens (из `title + body`).

3. Токенизация
   - Нижний регистр, очистка пунктуации.
   - Удаление русских стоп-слов.

4. Векторизация и оценка
   - TF для секций и запроса.
   - DF: в скольких секциях встречается слово.
   - Вес: `w = (1 + log(tf)) * (1 + log(N/df))`.
   - Косинусная близость: `dot / (||q|| * ||d||)`.

5. Выбор ответа
   - Сортируем секции по релевантности.
   - Если top-score < 0.05 — вежливый fallback.
   - Иначе возвращаем 1–2 лучших секции (title + краткий body).

6. Сжатие ответа
   - Ограничиваем длину ~600 символов на секцию.

7. UI поведение
   - Сообщения в стиле чата: пользователь справа, ассистент слева.
   - Блокируем кнопку «Отправить» во время ответа.

## Файлы
- Логика: `lib/utils/local_faq_qa.dart`
- Экран: `lib/screens/chat_assistant_screen.dart`
- Данные: `assets/faq.md`

## Ограничения
- Ключевые слова вместо семантических эмбеддингов.
- Качество зависит от полноты FAQ.
- Русский язык (стоп-слова) — адаптировать при добавлении языков.

## Идеи улучшений
- Лематизация/стемминг (ru).
- Встраивания/эмбеддинги (онлайн/офлайн модель).
- Кластеризация секций и интерактивная навигация по FAQ.
- Подсветка совпадающих слов в ответе.
